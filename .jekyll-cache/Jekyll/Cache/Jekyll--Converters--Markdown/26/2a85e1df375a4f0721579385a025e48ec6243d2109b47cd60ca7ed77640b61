I"‹<p>è¿™ç¯‡ç¬”è®°ç®€å•è®°å½•ä¸€ç‚¹å…³äºä½¿ç”¨Kerasè¿›è¡Œè‡ªç„¶è¯­è¨€å¤„ç†çš„å†…å®¹ã€‚ç”±äºä¸€ä¸ªå®éªŒçš„éœ€è¦ï¼Œéœ€è¦å¯¹ä¸€äº›å­—ç¬¦ä¸²è¿›è¡Œç®€å•çš„è‡ªç„¶è¯­è¨€å¤„ç†ã€‚å…·ä½“è€Œè¨€ï¼Œæˆ‘ä»¬éœ€è¦æŠŠå¾…åˆ†æå­—ç¬¦ä¸²çš„æ¯ä¸€ä¸ªå­—ç¬¦çœ‹ä½œä¸€ä¸ªè¯ï¼Œå¦‚æ­¤ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²å°±è½¬æ¢æˆäº†æœ‰è‹¥å¹²ä¸ªè¯çš„â€œä¸€æ®µè¯â€æˆ–â€œä¸€æ®µæ–‡ç« â€ã€‚è¿™æ ·å°±å¯ä»¥å¯¹è¿™ä¸ªå­—ç¬¦ä¸²é‡‡ç”¨å…¶ä»–è‡ªç„¶è¯­è¨€å¤„ç†æ–¹æ³•æ¥è¿›è¡Œåˆ†æã€‚</p>

<p>å®éªŒæ‰€ç”¨çš„æ·±åº¦å­¦ä¹ æ¡†æ¶æ˜¯Kerasï¼Œåç«¯ä¸ºTensorFlowã€‚åœ¨Kerasä¸­ï¼Œä¸Šè¿°çš„å¤„ç†æµç¨‹ååˆ†ç®€æ´ï¼Œæ­¥éª¤ä¸ºï¼š</p>

<ol>
  <li>
    <p>è¯»å–æ•°æ®</p>
  </li>
  <li>
    <p>å»ºç«‹tokenå­—å…¸</p>
  </li>
  <li>
    <p>ä½¿ç”¨tokenæŠŠæ–‡å­—è½¬æ¢ä¸ºæ•°å­—åˆ—è¡¨</p>
  </li>
  <li>
    <p>æˆªé•¿è¡¥çŸ­padding</p>
  </li>
  <li>
    <p>åç»­å¤„ç†</p>
  </li>
</ol>

<h2 id="ç¬¬ä¸€æ­¥è¯»å–æ•°æ®">ç¬¬ä¸€æ­¥ï¼šè¯»å–æ•°æ®</h2>

<p>ä½¿ç”¨<code class="highlighter-rouge">read_files()</code>å‡½æ•°è¯»å–æ•°æ®ï¼Œæœ€åŸºç¡€çš„åŠŸèƒ½ä»£ç å¦‚ä¸‹ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">read_files</span><span class="p">():</span>
    <span class="n">fi</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'data.txt'</span><span class="p">,</span> <span class="s">'rU'</span><span class="p">)</span>
    <span class="n">all_texts</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fi</span><span class="o">.</span><span class="n">readlines</span><span class="p">()]</span>
    <span class="k">return</span> <span class="n">all_texts</span>
</code></pre></div></div>
<p>å»ºç«‹all_textsåˆ—è¡¨ï¼Œåˆ—è¡¨çš„æ¯ä¸€é¡¹æ˜¯ä¸€ä¸²å­—ç¬¦ä¸²ï¼Œè§†å…¶ä¸ºä¸€æ®µæ–‡ç« ã€‚</p>

<h2 id="ç¬¬äºŒæ­¥å»ºç«‹tokenå­—å…¸">ç¬¬äºŒæ­¥ï¼šå»ºç«‹tokenå­—å…¸</h2>

<p>é¦–å…ˆå¯¼å…¥kerasæ¨¡å—ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">keras.preprocessing</span> <span class="kn">import</span> <span class="n">sequence</span>
<span class="kn">from</span> <span class="nn">keras.preprocessing.text</span> <span class="kn">import</span> <span class="n">Tokenizer</span>
</code></pre></div></div>

<p>å»ºç«‹tokenï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">token</span> <span class="o">=</span> <span class="n">Tokenizer</span><span class="p">(</span><span class="n">num_words</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">char_level</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">token</span><span class="o">.</span><span class="n">fit_on_texts</span><span class="p">(</span><span class="n">train_text</span><span class="p">)</span>
</code></pre></div></div>

<ul>
  <li>
    <p><code class="highlighter-rouge">num_words</code>ä¸ºå­—å…¸çš„å•è¯ä¸ªæ•°ï¼Œå› ä¸ºåœ¨æ­¤é—®é¢˜åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬æŠŠæ¯ä¸ªå­—ç¬¦çœ‹ä½œä¸€ä¸ªç‹¬ç«‹çš„å•è¯ï¼Œasciiåªæœ‰256ç§å­—ç¬¦ï¼Œå› æ­¤å­—å…¸å¤§å°ä¸º256ã€‚</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">filters</code>æ˜¯è¿‡æ»¤å™¨ã€‚</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">lower=True</code>è½¬æ¢ä¸ºå°å†™ã€‚</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">char_level</code>å³ä¸ºæ˜¯å¦æŠŠå•ä¸ªå­—ç¬¦è§†ä¸ºå•è¯ï¼Œä¹Ÿå°±æ˜¯é€å­—ç¬¦å¤„ç†ã€‚</p>
  </li>
</ul>

<p>è¿˜å¯ä»¥é€šè¿‡printå‡º<code class="highlighter-rouge">token.document_count</code>æŸ¥çœ‹è¯»å–äº†å¤šå°‘æ®µæ–‡ç« ï¼Œ<code class="highlighter-rouge">token.word_index</code>æŸ¥çœ‹å­—å…¸çš„å»ºç«‹æƒ…å†µã€‚</p>

<h2 id="ç¬¬ä¸‰æ­¥è½¬æ¢ä¸ºæ•°å­—åˆ—è¡¨">ç¬¬ä¸‰æ­¥ï¼šè½¬æ¢ä¸ºæ•°å­—åˆ—è¡¨</h2>

<p>ä½¿ç”¨keras tokençš„å†…ç½®æ–¹æ³•ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x_train_seq</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">texts_to_sequences</span><span class="p">(</span><span class="n">train_text</span><span class="p">)</span>
</code></pre></div></div>

<p>æŠŠæ–‡å­—è½¬æ¢ä¸ºæ•°å­—åˆ—è¡¨ã€‚<code class="highlighter-rouge">print(x_train_seq)</code>å³å¯æŸ¥çœ‹è½¬æ¢æƒ…å†µã€‚</p>

<h2 id="ç¬¬å››æ­¥padding">ç¬¬å››æ­¥ï¼špadding</h2>

<p>Kerasçš„paddingæ˜¯æˆªé•¿è¡¥çŸ­çš„ã€‚paddingä»£ç ä¸ºï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x_train</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">.</span><span class="n">pad_sequences</span><span class="p">(</span><span class="n">x_train_seq</span><span class="p">,</span> <span class="n">maxlen</span> <span class="o">=</span> <span class="mi">100</span><span class="p">)</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">maxlen</code>è§„å®špaddingçš„é•¿åº¦ã€‚</p>

<p>è¿™å°±æ˜¯kerasçš„æ•°æ®é¢„å¤„ç†çš„ä¸»è¦æ­¥éª¤å’ŒåŸºæœ¬ä»£ç ã€‚</p>

<blockquote>
  <p>å…³äºkerasçš„æ–‡å­—é¢„å¤„ç†è¯¦ç»†å†…å®¹ï¼Œå¯å‚è€ƒkerasæ–‡æ¡£ï¼š<a href="http://keras-cn.readthedocs.io/en/latest/preprocessing/text/">http://keras-cn.readthedocs.io/en/latest/preprocessing/text/</a></p>
</blockquote>
:ET